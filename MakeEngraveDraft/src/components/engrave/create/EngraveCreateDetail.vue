<template>
  <div class="">
    <div class="app">
      <div class="title2">
        ● [{{engraveType}}] 각인 종류 <br>
      </div>
      <div class="text-align-center">
        <div class="scroll-container">
          <span class="link-container">
            <!-- 일반 -->
            <div v-if="engraveType === '일반'">
              <div
                class="link-item"
                :class="{ selected: selectedType === '일반' }"
                @click="updateSelectType('일반')"
              >
                <img src="../../../assets/images/engrave/example/일반.png" width="80" height="130" alt="일반">
                <span class="selectText">[기본]</span>
              </div>
              <div
                class="link-item"
                :class="{ selected: selectedType === '형제' }"
                @click="updateSelectType('형제')"
              >
                <img src="../../../assets/images/engrave/example/일반(형제).png" width="80" height="130" alt="형제">
                <span class="selectText">[형제]</span>
              </div>
            </div>
            <!-- 기독교 -->
            <div v-if="engraveType === '기독교'">
              <div
                class="link-item"
                :class="{ selected: selectedType === '직분' }"
                @click="updateSelectType('직분')"
              >
                <img src="../../../assets/images/engrave/example/기독교.png" width="80" height="130" alt="기독교(직분)">
                <span class="selectText">[기본]</span>
              </div>
              <div
                class="link-item"
                :class="{ selected: selectedType === '기독교' }"
                @click="updateSelectType('기독교')"
              >
                <img src="../../../assets/images/engrave/example/기독교(직분x).png" width="80" height="130" alt="기독교(직분x)">
                <span class="selectText">[직분X]</span>
              </div>
            </div>
            <!-- 불교 -->
            <div v-if="engraveType === '불교'">
              <div
                class="link-item"
                :class="{ selected: selectedType === '불교' }"
                @click="updateSelectType('불교')"
              >
                <img src="../../../assets/images/engrave/example/불교.png" width="80" height="130" alt="불교">
                <span class="selectText">[기본]</span>
              </div>
              <div
                class="link-item"
                :class="{ selected: selectedType === '법명' }"
                @click="updateSelectType('법명')"
              >
                <img src="../../../assets/images/engrave/example/불교(법명).png" width="80" height="130" alt="불교(법명)">
                <span class="selectText">[법명]</span>
              </div> 
            </div>
            <!-- 천주교 -->
            <div v-if="engraveType === '천주교'">
              <div
                class="link-item"
                :class="{ selected: selectedType === '세례명' }"
                @click="updateSelectType('세례명')"
              >
                <img src="../../../assets/images/engrave/example/천주교.png" width="80" height="130" alt="천주교(세례명)">
                <span class="selectText">[기본]</span>
              </div>
              <div
                class="link-item"
                :class="{ selected: selectedType === '천주교' }"
                @click="updateSelectType('천주교')"
              >
                <img src="../../../assets/images/engrave/example/천주교(세례명x).png" width="80" height="130" alt="천주교)">
                <span class="selectText">[세례명X]</span>
              </div>
            </div>
            <!-- SGI -->
            <div v-if="engraveType === 'SGI'">
              <div
                class="link-item"
                :class="{ selected: selectedType === 'SGI' }"
                @click="updateSelectType('SGI')"
              >
                <img src="../../../assets/images/engrave/example/sgi.png" width="80" height="130" alt="SGI">
                <span class="selectText">[기본]</span>
              </div>
            </div>
            <!-- 묘법 -->
            <div v-if="engraveType === '묘법'">
              <div
                class="link-item"
                :class="{ selected: selectedType === '묘법' }"
                @click="updateSelectType('묘법')"
              >
                <img src="../../../assets/images/engrave/example/묘법.png" width="80" height="130" alt="묘법">
                <span class="selectText">[기본]</span>
              </div>
            </div>
          </span>
        </div>
      </div>
    </div>
    <hr>
    <!-- 정보입력 -->
    <div class="app">
      <div class="text-align-center">
        <span class="info-text-align-center">
          <div class="title3">
            정보 입력
          </div>
          <div>
            고인명<br>
            <input v-model="name1" type="text" placeholder="홍길동" style="height: 20px; width: 100%;"/>
            <div v-if="showName1KoreanWarning" class="warning_text">
              - 고인명을 한국어로 올바르게 입력해주세요.
            </div>
            <div v-else-if="showName1Warning" class="warning_text">
              - 고인명을 2~4글자로 입력해주세요.
            </div>
          </div>
          <!-- 날짜 입력 -->
          <div>
            생년월일 (숫자만 입력)<br>
            <input v-model="date1" type="text" :placeholder="Date1Placeholder" @input="handleDateInput($event, 'date1')" style="height: 20px; width: 79%; margin-right: 1%;">
            <!-- 날짜 입력 -->
            <select name="date1Type" v-model="date1Type" style="height: 20px; width: 20%;">
              <option value="양력" selected="selected">양력</option>
              <option value="음력">음력</option>
            </select>
            <div v-if="showDate1Warning" class="warning_text">
              - 생년월일을 {{ getDateWarningMessage(date1) }}
            </div>
          </div>
          <div>
            사망월일 (숫자만 입력)<br>
            <input v-model="date2" type="text" :placeholder="todayDate2Placeholder" @input="handleDateInput($event, 'date2')" style="height: 20px; width: 79%; margin-right: 1%">
            <select name="date2Type" v-model="date2Type" style="height: 20px; width: 20%;">
              <option value="양력" selected="selected">양력</option>
              <option value="음력">음력</option>
            </select>
            <div v-if="showDate2Warning" class="warning_text">
              - 사망월일을 {{ getDateWarningMessage(date2) }}
            </div>
          </div>
          <div v-if="selectedType === '직분'">
            직분
          </div>
          <div v-if="selectedType === '법명'">
            법명
          </div>
          <div v-if="selectedType === '세례명'">
            세례명
          </div>
          <div v-if="selectedType === '직분' || selectedType === '법명' || selectedType === '세례명'">
            <input v-model="name2" type="text" :placeholder="defaultName2Placeholder" style="height: 20px; width: 100%;"/>
            <div v-if="showName2KoreanWarning" class="warning_text">
              - {{selectedType}}을 한국어로 올바르게 입력해주세요.
            </div>
            <div v-else-if="showName2Warning && (selectedType === '직분' || selectedType === '법명')" class="warning_text">
              - {{selectedType}}을 2~4글자로 입력해주세요.
            </div>
            <div v-else-if="showName2Warning2 && (selectedType === '세례명')" class="warning_text">
              - {{selectedType}}을 2~6글자로 입력해주세요.
            </div>
          </div>
          <div>
            종교
            <input v-model="religion" type="text" :placeholder="defaultReligionPlaceholder" style="height: 20px; width: 100%;"/>
            <div v-if="showReligionKoreanWarning"  class="warning_text">
              - 종교를 한국어로 올바르게 입력해주세요.
            </div>
          </div>
          <div>
            유골함 종류<br>
            <select :value="selectedUrnType" @change="updateSelectedUrnType" style="height: 20px; width: 100%;">
              <option value="" disabled>유골함 선택</option>
              <option v-for="urn in urnTypes" :value="urn" :key="urn">{{ urn }}</option>
            </select>
          </div>
        </span>
      </div>
    </div>
    <div class="appbr">
      <br>
    </div>
    <div v-if="showRouterView" class="app">
      <div v-if="engraveType !== 'SGI' && engraveType !== '묘법'">
        <router-link :to="{name: 'tabletCreateView'}" @click.native="updateRouteData()" class="title4">
          👉 위패 주문하기
          <span class="title4_1">
            (Click!!)
          </span>
        </router-link>
      </div>
      <router-link :to="{name: 'result'}" @click.native="updateRouteData2()" class="title4">
        👉 예시 보기 (각인)
      </router-link>
    </div>
    <div v-else-if="!showRouterView">
      <div class="title5" @click="toggleRouterView">👉 위패 주문하지 않기!!</div>
      <router-view></router-view>
    </div>
  </div>
</template>

<script>
import { mapMutations, mapGetters } from 'vuex';

export default {
  data() {
    return {
      Date1Placeholder: '1900-01-01',
      todayDate2Placeholder: this.getTodayDate2Placeholder(),
    };
  },
  computed: {
    ...mapGetters([
      'getEngraveType',
      'getSelectedType',
      'getShowRouterView',

      'getName1',
      'getName2',
      'getDate1',
      'getDate1Type',
      'getDate2',
      'getDate2Type',
      'getReligion',
      'getSelectedUrnType',
    ]),
    engraveType: {
      get() {
        return this.$store.getters.getEngraveType;
      },
    },
    selectedType: {
      get() {
        return this.$store.getters.getSelectedType;
      },
    },
    showRouterView: {
      get() {
        return this.$store.getters.getShowRouterView;
      },
      set(value) {
        this.$store.commit('updateShowRouterView', value);
      }
    },
    name1: {
      get() {
        return this.$store.getters.getName1;
      },
      set(value) {
        this.$store.commit('updateName1', value);
      }
    },
    name2: {
      get() {
        return this.$store.getters.getName2;
      },
      set(value) {
        this.$store.commit('updateName2', value);
      }
    },
    date1: {
      get() {
        return this.$store.getters.getDate1;
      },
      set(value) {
        this.$store.commit('updateDate1', value);
      },
    },
    date1Type: {
      get() {
        return this.$store.getters.getDate1Type;
      },
      set(value) {
        this.$store.commit('updateDate1Type', value);
      }
    },
    date2: {
      get() {
        return this.$store.getters.getDate2;
      },
      set(value) {
        return this.$store.commit('updateDate2', value);
      },
    },
    date2Type: {
      get() {
        return this.$store.getters.getDate2Type;
      },
      set(value) {
        this.$store.commit('updateDate2Type', value);
      }
    },
    religion: {
      get() {
        return this.$store.getters.getReligion;
      },
      set(value) {
        this.$store.commit('updateReligion', value);
      }
    },
    urnTypes() {
      return ['유골함1', '유골함2', '유골함3', '합골1', '합골2'];
    },
    selectedUrnType: {
      get() {
        return this.$store.getters.getSelectedUrnType;
      },
      set(value) {
        this.$store.commit('updateSelectedUrnType', value);
      }
    },
    defaultName2Placeholder() {
      // 여기서 기본 placeholder 값을 설정합니다
      return this.selectedType;
    },
    defaultReligionPlaceholder(){
      if(this.engraveType == '기독교' || this.engraveType == '불교' || this.engraveType == '천주교'){
        this.religion = this.engraveType;
        return this.engraveType;
      }
      else{
        this.religion = '';
        return '종교 입력';
      }
    },
    showName1Warning() {
      const name1Length = this.name1.trim().length;
      return (name1Length < 2 || name1Length > 4) && name1Length !== 0;
    },
    showName1KoreanWarning() {
      // 한글 문자에 대한 정규식
      const koreanRegex= /^[가-힣]*$/;
      const koreanConsonantVowelRegex = /^[가-힣&&[^ㅏ-ㅣㅑ-ㅣㅓ-ㅣㅕ-ㅣㅗ-ㅣㅛ-ㅣㅜ-ㅣㅠ-ㅣㅡ-ㅣ]]*$/;

      if(this.name1.length === 0)
        return false;

      return !(koreanRegex.test(this.name1) && !koreanConsonantVowelRegex.test(this.name1));
    },
    showName2Warning() {
      const name2Length = this.name2.trim().length;
      return (name2Length < 2 || name2Length > 4) && name2Length !== 0;
    },
    showName2Warning2() {
      const name2Length = this.name2.trim().length;
      return (name2Length < 2 || name2Length > 6) && name2Length !== 0;
    },
    showName2KoreanWarning() {
      // 한글 문자에 대한 정규식
      const koreanRegex= /^[가-힣]*$/;
      const koreanConsonantVowelRegex = /^[가-힣&&[^ㅏ-ㅣㅑ-ㅣㅓ-ㅣㅕ-ㅣㅗ-ㅣㅛ-ㅣㅜ-ㅣㅠ-ㅣㅡ-ㅣ]]*$/;

      if(this.name2.length === 0)
        return false;

      return !(koreanRegex.test(this.name2) && !koreanConsonantVowelRegex.test(this.name2));
    },
    showDate1Warning() {
      return this.showDateWarning(this.date1);
    },
    showDate2Warning() {
      return this.showDateWarning(this.date2);
    },
    showReligionKoreanWarning() {
      // 한글 문자에 대한 정규식
      const koreanRegex= /^[가-힣]*$/;
      const koreanConsonantVowelRegex = /^[가-힣&&[^ㅏ-ㅣㅑ-ㅣㅓ-ㅣㅕ-ㅣㅗ-ㅣㅛ-ㅣㅜ-ㅣㅠ-ㅣㅡ-ㅣ]]*$/;

      if(this.religion.length === 0)
        return false;

      return !(koreanRegex.test(this.religion) && !koreanConsonantVowelRegex.test(this.religion));
    },
  },
  methods: {
    ...mapMutations(['toggleRouterView']),
    toggleRouterView() {
      this.$store.commit('updateShowRouterView',!this.showRouterView);
    },
    updateSelectType(selectedType){
      this.$store.commit('updateSelectedType', selectedType);
      this.$store.commit('updateShowRouterView', true);
    },
    encodedName1() {
      const trimmedName1 = this.name1.trim();
      return trimmedName1 === '' ? '홍길동' : encodeURIComponent(trimmedName1);
    },
    encodedName2() {
      const trimmedName2 = this.name2.trim();

      if(this.engraveType === '기독교')
        return trimmedName2 === '' ? '직분' : encodeURIComponent(trimmedName2);
      else if(this.engraveType === '불교')
        return trimmedName2 === '' ? '법명' : encodeURIComponent(trimmedName2);
      else if(this.engraveType === '천주교')
        return trimmedName2 === '' ? '세례명' : encodeURIComponent(trimmedName2);

      return trimmedName2 === '' ? this.selectedType : encodeURIComponent(trimmedName2);
    },
    encodedDate1() {
      const trimmedDate1 = this.date1.trim();
      return trimmedDate1 === '' ? this.Date1Placeholder : encodeURIComponent(trimmedDate1);
    },
    encodedDate2() {
      const trimmedDate2 = this.date2.trim();
      return trimmedDate2 === '' ? this.todayDate2Placeholder : encodeURIComponent(trimmedDate2);
    },
    getTodayDate2Placeholder() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },
    handleDateInput(event, targetDate) {
      const inputValue = event.target.value;
      const numericValue = inputValue.replace(/\D/g, ''); // 숫자만 추출

      // 숫자 입력 값을 날짜 형식으로 변환
      let formattedDate = '';

      if (numericValue.length >= 6) {
        const year = numericValue.substring(0, 4);
        formattedDate += year;
        const month = numericValue.substring(4, 6).padStart(2, '0');

        if (numericValue.length >= 8) {
          const day = numericValue.substring(6, 8).padStart(2, '0');
          formattedDate += `-${month}-${day}`;
        } else {
          formattedDate += `-${month}-${numericValue.substring(6)}`;
        }
      } else {
        formattedDate = inputValue;
      }

      // 마지막 글자가 하이폰인 경우 제거
      if (formattedDate.endsWith('-')) {
        formattedDate = formattedDate.slice(0, -1);
      }

      // 날짜 형식으로 변환한 값을 갱신
      if (targetDate === 'date1') {
        this.date1 = formattedDate;
      } else if (targetDate === 'date2') {
        this.date2 = formattedDate;
      }
    },
    showDateWarning(date) {
      if(date.length == 0)
        return false;

      const datePattern = /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/;

      if (!datePattern.test(date)) {
        return true;
      }

      const parts = date.split('-');
      const year = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10);
      const day = parseInt(parts[2], 10);

      if (month < 1 || month > 12 || day < 1 || day > new Date(year, month, 0).getDate()) {
        return true;
      }

      return false;
    },
    getDateWarningMessage(date) {
      const datePattern = /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/;

      if (!datePattern.test(date)) {
        return "올바른 날짜 형식(yyyy-mm-dd)으로 입력해주세요.";
      }

      const parts = date.split('-');
      const year = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10);
      const day = parseInt(parts[2], 10);

      if (month < 1 || month > 12) {
        return "올바른 월(1~12)로 입력해주세요.";
      }

      const lastDayOfMonth = new Date(year, month, 0).getDate();
      if (day < 1 || day > lastDayOfMonth) {
        return `올바른 일(1~${lastDayOfMonth})로 입력해주세요.`;
      }

      return "";
    },
    updateRouteData(){
      this.$store.commit('updateName3', '')
      this.name1 = decodeURIComponent(this.encodedName1());
      this.name2 = decodeURIComponent(this.encodedName2());
      this.date1 = decodeURIComponent(this.encodedDate1());
      this.date1Type ='양력';
      this.date2 = decodeURIComponent(this.encodedDate2());
      this.date2Type ='양력';
      this.$store.commit('updateSelectedType2', this.engraveType);
      this.showRouterView = false;
    },
    updateRouteData2(){
      this.name1 = decodeURIComponent(this.encodedName1());
      this.name2 = decodeURIComponent(this.encodedName2());
      this.date1 = decodeURIComponent(this.encodedDate1());
      this.date1Type ='양력';
      this.date2 = decodeURIComponent(this.encodedDate2());
      this.date2Type ='양력';
      this.$store.commit('updateSelectedType2', '없음');
      // 로컬스토리지 저장
      this.$store.commit('updateName3', '없음')
    },
    updateSelectedUrnType(event) {
      this.selectedUrnType = event.target.value;
    },
  },
};
</script>

<style>
.info-text-align-center {
  width: 100%;
  display: inline-block;
  text-align: left;
  /* background-color: blue; */
}
</style>