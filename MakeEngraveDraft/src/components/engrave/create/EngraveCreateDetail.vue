<template>
  <div class="">
    <div class="title2">
      â— {{type}} ê°ì¸ ì¢…ë¥˜ <br>
    </div>
    <div class="text-align-center">
      <span class="link-item-color">
        <!-- ì¼ë°˜ -->
        <div v-if="type === 'ì¼ë°˜'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ì¼ë°˜' }"
            @click="updateSelectType('ì¼ë°˜')"
          >
            <img src="../../../assets/images/engrave/example/ì¼ë°˜.png" width="80" height="130" alt="ì¼ë°˜">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
          <button
            class="link-item"
            :class="{ selected: selectedType === 'í˜•ì œ' }"
            @click="updateSelectType('í˜•ì œ')"
          >
            <img src="../../../assets/images/engrave/example/ì¼ë°˜(í˜•ì œ).png" width="80" height="130" alt="í˜•ì œ">
            <span class="selectText">[í˜•ì œ]</span>
          </button>
        </div>
        <!-- ê¸°ë…êµ -->
        <div v-if="type === 'ê¸°ë…êµ'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ì§ë¶„' }"
            @click="updateSelectType('ì§ë¶„')"
          >
            <img src="../../../assets/images/engrave/example/ê¸°ë…êµ.png" width="80" height="130" alt="ê¸°ë…êµ(ì§ë¶„)">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ê¸°ë…êµ' }"
            @click="updateSelectType('ê¸°ë…êµ')"
          >
            <img src="../../../assets/images/engrave/example/ê¸°ë…êµ(ì§ë¶„x).png" width="80" height="130" alt="ê¸°ë…êµ(ì§ë¶„x)">
            <span class="selectText">[ì§ë¶„X]</span>
          </button>
        </div>
        <!-- ë¶ˆêµ -->
        <div v-if="type === 'ë¶ˆêµ'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ë¶ˆêµ' }"
            @click="updateSelectType('ë¶ˆêµ')"
          >
            <img src="../../../assets/images/engrave/example/ë¶ˆêµ.png" width="80" height="130" alt="ë¶ˆêµ">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ë²•ëª…' }"
            @click="updateSelectType('ë²•ëª…')"
          >
            <img src="../../../assets/images/engrave/example/ë¶ˆêµ(ë²•ëª…).png" width="80" height="130" alt="ë¶ˆêµ(ë²•ëª…)">
            <span class="selectText">[ë²•ëª…]</span>
          </button> 
        </div>
        <!-- ì²œì£¼êµ -->
        <div v-if="type === 'ì²œì£¼êµ'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ì„¸ë¡€ëª…' }"
            @click="updateSelectType('ì„¸ë¡€ëª…')"
          >
            <img src="../../../assets/images/engrave/example/ì²œì£¼êµ.png" width="80" height="130" alt="ì²œì£¼êµ(ì„¸ë¡€ëª…)">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ì²œì£¼êµ' }"
            @click="updateSelectType('ì²œì£¼êµ')"
          >
            <img src="../../../assets/images/engrave/example/ì²œì£¼êµ(ì„¸ë¡€ëª…x).png" width="80" height="130" alt="ì²œì£¼êµ)">
            <span class="selectText">[ì„¸ë¡€ëª…X]</span>
          </button>
        </div>
        <!-- SGI -->
        <div v-if="type === 'SGI'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'SGI' }"
            @click="updateSelectType('SGI')"
          >
            <img src="../../../assets/images/engrave/example/sgi.png" width="80" height="130" alt="SGI">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
        </div>
        <!-- ë¬˜ë²• -->
        <div v-if="getType === 'ë¬˜ë²•'">
          <button
            class="link-item"
            :class="{ selected: selectedType === 'ë¬˜ë²•' }"
            @click="updateSelectType('ë¬˜ë²•')"
          >
            <img src="../../../assets/images/engrave/example/ë¬˜ë²•.png" width="80" height="130" alt="ë¬˜ë²•">
            <span class="selectText">[ê¸°ë³¸]</span>
          </button>
        </div>
      </span>
    </div>
    <!-- ì •ë³´ì…ë ¥ -->
    <div class="text-align-center">
      <span class="info-text-align-center">
        <div class="title3">
          ì •ë³´ ì…ë ¥
        </div>
        <span class="input-info1">
          <div>
            ê³ ì¸ì„±í•¨&nbsp;
          </div>
          <div v-if="selectedType === 'ì§ë¶„'">
            ì§ë¶„&nbsp;
          </div>
          <div v-if="selectedType === 'ë²•ëª…'">
            ë²•ëª…&nbsp;
          </div>
          <div v-if="selectedType === 'ì„¸ë¡€ëª…'">
            ì„¸ë¡€ëª…&nbsp;
          </div>
          <!-- ë‚ ì§œ ì…ë ¥ -->
          <div>
            ì¶œìƒì¼&nbsp;
          </div>
          <div>
            ì‚¬ë§ì¼&nbsp;
          </div>
        </span>
        <span class="input-info2">
          <div>
            <input v-model="name1" type="text" placeholder="í™ê¸¸ë™" style="width: 7em;"/>
          </div>
          <div v-if="selectedType === 'ì§ë¶„' || selectedType === 'ë²•ëª…' || selectedType === 'ì„¸ë¡€ëª…'">
            <input v-model="name2" type="text" :placeholder="defaultName2Placeholder" style="width: 7em;"/>
          </div>
          <div>
            <input v-model="date1" type="text" :placeholder="Date1Placeholder" @input="handleDateInput($event, 'date1')" style="width: 7em;">&nbsp;
            <!-- ë‚ ì§œ ì…ë ¥ -->
            <select name="date1Type" v-model="date1Type">
              <option value="ì–‘ë ¥" selected="selected">ì–‘ë ¥</option>
              <option value="ìŒë ¥">ìŒë ¥</option>
            </select>
          </div>
          <div>
            <input v-model="date2" type="text" :placeholder="todayDate2Placeholder" @input="handleDateInput($event, 'date2')" style="width: 7em;">&nbsp;
            <select name="date2Type" v-model="date2Type">
              <option value="ì–‘ë ¥" selected="selected">ì–‘ë ¥</option>
              <option value="ìŒë ¥">ìŒë ¥</option>
            </select>
          </div>
        </span>
      </span>
    </div>
    <hr>
    <div v-if="showName1KoreanWarning" class="warning_text">
      - ì„±í•¨ì„ í•œêµ­ì–´ë¡œ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>
    <div v-else-if="showName1Warning" class="warning_text">
      - ì„±í•¨ì„ 2~4ê¸€ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>
    <div v-else-if="showName2KoreanWarning && (selectedType === 'ì§ë¶„' || selectedType === 'ë²•ëª…' || selectedType === 'ì„¸ë¡€ëª…')" class="warning_text">
      - {{selectedType}}ì„ í•œêµ­ì–´ë¡œ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>
    <div v-else-if="showName2Warning && (selectedType === 'ì§ë¶„' || selectedType === 'ë²•ëª…')" class="warning_text">
      - {{selectedType}}ì„ 2~4ê¸€ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>
    <div v-else-if="showName3Warning && (selectedType === 'ì„¸ë¡€ëª…')" class="warning_text">
      - {{selectedType}}ì„ 2~6ê¸€ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.
    </div>
    <div v-else-if="showDate1Warning" class="warning_text">
      - ì¶œìƒì¼ì„ {{ getDateWarningMessage(date1) }}
    </div>
    <div v-else-if="showDate2Warning" class="warning_text">
      - ì‚¬ë§ì¼ì„ {{ getDateWarningMessage(date2) }}
    </div>
    <div v-else-if="showRouterView">
      <div v-if="type !== 'SGI' && type !== 'ë¬˜ë²•'">
        <router-link :to="{name: 'tabletCreateView'}" @click.native="updateRouteData()">
          <div class="title4">
            ğŸ‘‰ ìœ„íŒ¨ ì£¼ë¬¸í•˜ê¸°
            <span class="title4_1">
              (Click!!)
            </span>
          </div>
        </router-link>
      </div>
      <router-link :to="{name: 'result'}" @click.native="updateRouteData2()" class="title4">
        ğŸ‘‰ ì˜ˆì‹œ ë³´ê¸° (ê°ì¸)
      </router-link>
    </div>
    <div v-else-if="!showRouterView">
      <div class="title5" @click="toggleRouterView">ğŸ‘‰ ìœ„íŒ¨ ì£¼ë¬¸í•˜ì§€ ì•Šê¸°!!</div>
      <router-view></router-view>
    </div>
  </div>
</template>

<script>
import { mapMutations, mapGetters } from 'vuex';

export default {
  data() {
    return {
      Date1Placeholder: '1900-01-01',
      todayDate2Placeholder: this.getTodayDate2Placeholder(),
    };
  },
  computed: {
    ...mapGetters([
      'getType',
      'getSelectedType',
      'getShowRouterView',

      'getName1',
      'getName2',
      'getDate1',
      'getDate1Type',
      'getDate2',
      'getDate2Type',
    ]),
    type: {
      get() {
        return this.$store.getters.getType;
      },
    },
    selectedType: {
      get() {
        return this.$store.getters.getSelectedType;
      },
    },
    showRouterView: {
      get() {
        return this.$store.getters.getShowRouterView;
      },
      set(value) {
        this.$store.commit('updateShowRouterView', value);
      }
    },
    name1: {
      get() {
        return this.$store.getters.getName1;
      },
      set(value) {
        this.$store.commit('updateName1', value);
      }
    },
    name2: {
      get() {
        return this.$store.getters.getName2;
      },
      set(value) {
        this.$store.commit('updateName2', value);
      }
    },
    date1: {
      get() {
        return this.$store.getters.getDate1;
      },
      set(value) {
        this.$store.commit('updateDate1', value);
      },
    },
    date1Type: {
      get() {
        return this.$store.getters.getDate1Type;
      },
      set(value) {
        this.$store.commit('updateDate1Type', value);
      }
    },
    date2: {
      get() {
        return this.$store.getters.getDate2;
      },
      set(value) {
        return this.$store.commit('updateDate2', value);
      },
    },
    date2Type: {
      get() {
        return this.$store.getters.getDate2Type;
      },
      set(value) {
        this.$store.commit('updateDate2Type', value);
      }
    },
    defaultName2Placeholder() {
      // ì—¬ê¸°ì„œ ê¸°ë³¸ placeholder ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤
      return this.selectedType;
    },
    showName1Warning() {
      const name1Length = this.name1.trim().length;
      return (name1Length < 2 || name1Length > 4) && name1Length !== 0;
    },
    showName1KoreanWarning() {
      // í•œê¸€ ë¬¸ìì— ëŒ€í•œ ì •ê·œì‹
      const koreanRegex= /^[ê°€-í£]*$/;
      const koreanConsonantVowelRegex = /^[ê°€-í£&&[^ã…-ã…£ã…‘-ã…£ã…“-ã…£ã…•-ã…£ã…—-ã…£ã…›-ã…£ã…œ-ã…£ã… -ã…£ã…¡-ã…£]]*$/;

      if(this.name1.length === 0)
        return false;

      return !(koreanRegex.test(this.name1) && !koreanConsonantVowelRegex.test(this.name1));
    },
    showName2Warning() {
      const name2Length = this.name2.trim().length;
      return (name2Length < 2 || name2Length > 4) && name2Length !== 0;
    },
    showName3Warning() {
      const name2Length = this.name2.trim().length;
      return (name2Length < 2 || name2Length > 6) && name2Length !== 0;
    },
    showName2KoreanWarning() {
      // í•œê¸€ ë¬¸ìì— ëŒ€í•œ ì •ê·œì‹
      const koreanRegex= /^[ê°€-í£]*$/;
      const koreanConsonantVowelRegex = /^[ê°€-í£&&[^ã…-ã…£ã…‘-ã…£ã…“-ã…£ã…•-ã…£ã…—-ã…£ã…›-ã…£ã…œ-ã…£ã… -ã…£ã…¡-ã…£]]*$/;

      if(this.name2.length === 0)
        return false;

      return !(koreanRegex.test(this.name2) && !koreanConsonantVowelRegex.test(this.name2));
    },
    showDate1Warning() {
      return this.showDateWarning(this.date1);
    },
    showDate2Warning() {
      return this.showDateWarning(this.date2);
    },
  },
  methods: {
    ...mapMutations(['toggleRouterView']),
    toggleRouterView() {
      this.$store.commit('updateShowRouterView',!this.showRouterView);
    },
    updateSelectType(selectedType){
      this.$store.commit('updateSelectedType', selectedType);
      this.$store.commit('updateShowRouterView', true);
    },
    encodedName1() {
      const trimmedName1 = this.name1.trim();
      return trimmedName1 === '' ? 'í™ê¸¸ë™' : encodeURIComponent(trimmedName1);
    },
    encodedName2() {
      const trimmedName2 = this.name2.trim();

      if(this.type === 'ê¸°ë…êµ')
        return trimmedName2 === '' ? 'ì§ë¶„' : encodeURIComponent(trimmedName2);
      else if(this.type === 'ë¶ˆêµ')
        return trimmedName2 === '' ? 'ë²•ëª…' : encodeURIComponent(trimmedName2);
      else if(this.type === 'ì²œì£¼êµ')
        return trimmedName2 === '' ? 'ì„¸ë¡€ëª…' : encodeURIComponent(trimmedName2);

      return trimmedName2 === '' ? this.selectedType : encodeURIComponent(trimmedName2);
    },
    encodedDate1() {
      const trimmedDate1 = this.date1.trim();
      return trimmedDate1 === '' ? this.Date1Placeholder : encodeURIComponent(trimmedDate1);
    },
    encodedDate2() {
      const trimmedDate2 = this.date2.trim();
      return trimmedDate2 === '' ? this.todayDate2Placeholder : encodeURIComponent(trimmedDate2);
    },
    getTodayDate2Placeholder() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },
    handleDateInput(event, targetDate) {
      const inputValue = event.target.value;
      const numericValue = inputValue.replace(/\D/g, ''); // ìˆ«ìë§Œ ì¶”ì¶œ

      // ìˆ«ì ì…ë ¥ ê°’ì„ ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      let formattedDate = '';

      if (numericValue.length >= 6) {
        const year = numericValue.substring(0, 4);
        formattedDate += year;
        const month = numericValue.substring(4, 6).padStart(2, '0');

        if (numericValue.length >= 8) {
          const day = numericValue.substring(6, 8).padStart(2, '0');
          formattedDate += `-${month}-${day}`;
        } else {
          formattedDate += `-${month}-${numericValue.substring(6)}`;
        }
      } else {
        formattedDate = inputValue;
      }

      // ë§ˆì§€ë§‰ ê¸€ìê°€ í•˜ì´í°ì¸ ê²½ìš° ì œê±°
      if (formattedDate.endsWith('-')) {
        formattedDate = formattedDate.slice(0, -1);
      }

      // ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•œ ê°’ì„ ê°±ì‹ 
      if (targetDate === 'date1') {
        this.date1 = formattedDate;
      } else if (targetDate === 'date2') {
        this.date2 = formattedDate;
      }
    },
    showDateWarning(date) {
      if(date.length == 0)
        return false;

      const datePattern = /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/;

      if (!datePattern.test(date)) {
        return true;
      }

      const parts = date.split('-');
      const year = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10);
      const day = parseInt(parts[2], 10);

      if (month < 1 || month > 12 || day < 1 || day > new Date(year, month, 0).getDate()) {
        return true;
      }

      return false;
    },
    getDateWarningMessage(date) {
      const datePattern = /^[0-9]{4}-[0-9]{2}-[0-9]{2}$/;

      if (!datePattern.test(date)) {
        return "ì˜¬ë°”ë¥¸ ë‚ ì§œ í˜•ì‹(yyyy-mm-dd)ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      }

      const parts = date.split('-');
      const year = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10);
      const day = parseInt(parts[2], 10);

      if (month < 1 || month > 12) {
        return "ì˜¬ë°”ë¥¸ ì›”(1~12)ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      }

      const lastDayOfMonth = new Date(year, month, 0).getDate();
      if (day < 1 || day > lastDayOfMonth) {
        return `ì˜¬ë°”ë¥¸ ì¼(1~${lastDayOfMonth})ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.`;
      }

      return "";
    },
    updateRouteData(){
      this.$store.commit('updateName0', '')
      this.name1 = decodeURIComponent(this.encodedName1());
      this.name2 = decodeURIComponent(this.encodedName2());
      this.date1 = decodeURIComponent(this.encodedDate1());
      this.date1Type ='ì–‘ë ¥';
      this.date2 = decodeURIComponent(this.encodedDate2());
      this.date2Type ='ì–‘ë ¥';
      this.$store.commit('updateSelectedType2', this.type);
      this.showRouterView = false;
    },
    updateRouteData2(){
      this.name1 = decodeURIComponent(this.encodedName1());
      this.name2 = decodeURIComponent(this.encodedName2());
      this.date1 = decodeURIComponent(this.encodedDate1());
      this.date1Type ='ì–‘ë ¥';
      this.date2 = decodeURIComponent(this.encodedDate2());
      this.date2Type ='ì–‘ë ¥';
      this.$store.commit('updateSelectedType2', 'ì—†ìŒ');
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
      this.$store.commit('updateName0', 'ì—†ìŒ')
    }
  },
};
</script>

<style>
.info-text-align-center {
  display: inline-block;
  text-align: left;
}

.link-item-color {
  display: inline-block;
  justify-content: center;
  align-items: center;
  background-color: #cfcfcf; /* ë°°ê²½ìƒ‰ì„ ì„¤ì •í•©ë‹ˆë‹¤ */
  padding: 3px;
  margin-top: 2px;
  margin-bottom: 6px;
  border-radius: 5px;
}

.title3 {
  text-align: center;
  color: #baca11;
}

.title4 {
  font-size: 20px;
  font-family: "BMEULJIROTTF";
  color: red;
  cursor: pointer;
}

.title4_1 {
  color: pink;
}

.title5 {
  font-size: 20px;
  font-family: "BMEULJIROTTF";
  color: green;
  cursor: pointer;
}

.input-info1 {
  display: inline-block;
  justify-content: center;
  text-align: center;
  font-weight: bold;
  padding: 3px;
  /* background-color: rgb(81, 59, 59); */
}

.input-info2 {
  display: inline-block;
  justify-content: center;
  /* background-color: rgb(63, 103, 103); */
}

input::placeholder {
  text-align: center;
}

.warning_text{
  font-size: 18px;
  font-family: "BMEULJIROTTF";
  color: rgb(246, 63, 63);
}
</style>